---
title: 'Linear Time Series Assignment : ARIMA modelling of a time series'
author: "Solène MORO & Jonas LECHAT"
date: "2024-04"
output: pdf_document
---


```{r packages, include=FALSE}
library(insee)
library(data.table)
library(tidyverse)
library(zoo)
library(tseries)
library(fUnitRoots)
library(astsa)
library(forecast)
library(portes)
library(ggplot2)
```

```{r données, include=FALSE}
data = as.data.table(insee::get_insee_idbank("010767581"))
data=data[,c("DATE", "OBS_VALUE")]
setnames(data, c("DATE", "extraction_petrole"))
data<-data[order(as.Date(data$DATE)),]
```


# PART 1: The data
## Question 1 :
The data is a time series of INSEE representing the variation in extraction of crude oil, using the average for 2021 as a reference, at base 100. The series can be find on the INSEE website, it is called "Indice CVS-CJO de la production industrielle (base 100 en 2021) - Extraction de pétrole brut (NAF rév. 2, niveau groupe, poste 06.10)"


## Question 2


```{r}
summary(lm(extraction_petrole~DATE, data=data))
```
We did 3 tests to test the stationarity of our series . The Philips Perron test, KPSS test and Dickey Fuller test (where we have included a constant and a trend) :

```{r, echo=FALSE, warning=FALSE}
pp.test(data[,extraction_petrole])
adfTest(data[,extraction_petrole], type="ct")
kpss.test(data[,extraction_petrole])
```

 All tests reject the stationarity at the 1% level. The series is thus non stationary, this confirms what we can see on its graph on question 3.

We therefore chose to use the first difference method to make our series stationary, and its stationarity was thus verified by the three tests :


```{r, echo=FALSE, warning=FALSE}
pp.test(diff(data[,extraction_petrole]))
adf.test(diff(data[,extraction_petrole]))
kpss.test(diff(data[,extraction_petrole]))
```


## Question 3
 We can see graphically that the transformation of the series using the first difference method makes the series stationary:
```{r, echo=FALSE}
ggplot(data, aes(x = DATE, y = extraction_petrole)) +
  geom_line(color = "blue") +  
  labs(title = "Oil extraction",
       x = "Date",                                  
       y = "Oil extraction") +
  theme_minimal()   
```


```{r, include=FALSE}
diff_petrole=diff(data[,extraction_petrole])
data[DATE>"1990-01-01", extraction_petrole_diff:=diff_petrole]
```


```{r, echo=FALSE, warning=FALSE}
ggplot(data, aes(x = DATE, y = extraction_petrole_diff)) +
  geom_line(color = "blue") +  
  labs(title = "First difference of the oil extraction",
       x = "Date",                                  
       y = "FD Oil extraction") +
  theme_minimal()   
```

# PART 2 : ARMA models
## Question 4
We realise the ACF and PCF analysis : 
```{r, echo=FALSE}
acf(diff(data[,extraction_petrole]))
pacf(diff(data[,extraction_petrole]))
```
The ACF suggests that we test the ARMA models for which q is lower or equal to 4.
The PCF suggests that we test the ARMA models for which p is lower or equal to  too.
Thus, We have to test the significancy of the coefficients for all ARIMA(p,1,q)  models for p and q between 0 and 4 :
```{r, include=FALSE}
for (i in 0:4) {
  sarima(data[,extraction_petrole], 4,1,i, details= FALSE)
  sarima(data[,extraction_petrole], 3,1,i, details= FALSE)
  sarima(data[,extraction_petrole], 2,1,i, details= FALSE)
  sarima(data[,extraction_petrole], 1,1,i, details= FALSE)
  sarima(data[,extraction_petrole], 0,1,i, details= FALSE)
}
```
We decide to reject the model if the p-values of some coefficients are higher than 5%. Thus, we keep for now the following models : 
```{r, echo=FALSE}
res20<-sarima(data[,extraction_petrole], 2,1,0, details= FALSE)
res10<-sarima(data[,extraction_petrole], 1,1,0, details= FALSE)
res01<-sarima(data[,extraction_petrole], 0,1,1, details= FALSE)
res23<-sarima(data[,extraction_petrole], 2,1,3, details= FALSE)
res43<-sarima(data[,extraction_petrole], 4,1,3, details= FALSE)
```

```{r, echo=FALSE}
print("ARIMA(2,1,0)")
LjungBox(res20$fit)
print("ARIMA(1,1,0)")
LjungBox(res10$fit)
print("ARIMA(0,1,1)")
LjungBox(res01$fit)
print("ARIMA(2,1,3)")
LjungBox(res23$fit)
print("ARIMA(4,1,3)")
LjungBox(res43$fit)
```
"ARIMA(2,1,3)"
"ARIMA(4,1,3)"


```{r}
AIC(res23$fit)
AIC(res43$fit)

BIC(res23$fit)
BIC(res43$fit)
```
## Question 5
